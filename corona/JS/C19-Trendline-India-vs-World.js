$(document).ready(function(){
    const canvas = document.getElementById("canvas");
    const canHgt = 560;
    const canWidAvailable = 650;
    const canWid = 740;
    canvas.style.height = canHgt+'px';
    canvas.style.width = canWid+'px';
    canvas.height = canHgt*2;
    canvas.width = canWid*2;
    const ctx = canvas.getContext("2d");
    ctx.scale(2,2);
    ctx.lineWidth = 2;
    ctx.strokeColor = '#000'
   
    const colorArray = ['#92C24C77','#C9224C77','#C2924C77','#C24C9277','#C2492C77'];
    let slideIndex;
    let counter = 0;
    let circleArray = [];
    let confirmedColorSwitch ='#E26666';
    let confirmedColor ='#AFB6D0';
    let recoveredColor ='#55ABEA';
    let deathColor ='#ca9828';
    const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
    let today = new Date();
    let dateLiteral = today.getDate();
    dateLiteral>9?dateLiteral=dateLiteral:dateLiteral='0'+dateLiteral

    const todayData = [{
        dailyconfirmed: "",
        dailydeceased: "",
        dailyrecovered: "",
        date: "23 August",
        totalconfirmed: "3044940",
        totaldeceased: "56706",
        totalrecovered: "2280566",
    }]
	console.log(todayData);
	$('.headline').text('India vs World').css({top: 112})
	$('.legendVertical').text('Cases per Million')
	$('.strap').text('Cases per Million Trajectory').css({textTransform: 'uppercase'})
	$('.legendDataBlock.confirmed>.nameLabel').text('World')
	$('.legendDataBlock.recovered>.nameLabel').text('India')
    // const widthStep = canWidAvailable/todayData['dates'].length;
    const heightFactor = 5500;
    const countriesFactor = 250;
    const heightStep = canHgt/heightFactor;
    let counterPrev  = 1;
    let secs = 100;
    // const countNum = [8,52,67,76,82];
    // const countText = ['','100+','1000+','5000+','10000+']
    const countNum =[]
    var json = JSON.parse($.ajax({'url': "/data/data.json", 'async': false}).responseText);
    // let dailyCumulative = json['cases_time_series'];
    // dailyCumulative = dailyCumulative.slice(62)
    // for (let index = 0; index < todayData.length; index++) {
    //     dailyCumulative.push(todayData[index]) 
	// }
	const worldPop = 7816
	const indiaPop = 1383
	let dailyCumulative = [
		[[1, 22, 20],0,555],[[1, 23, 20],0,654],[[1, 24, 20],0,941],[[1, 25, 20],0,1434],[[1, 26, 20],0,2118],[[1, 27, 20],0,2927],[[1, 28, 20],0,5578],[[1, 29, 20],0,6167],[[1, 30, 20],1,8235],[[1, 31, 20],1,9927],[[2, 1, 20],1,12038],[[2, 2, 20],2,16787],[[2, 3, 20],3,19887],[[2, 4, 20],3,23898],[[2, 5, 20],3,27643],[[2, 6, 20],3,30803],[[2, 7, 20],3,34396],[[2, 8, 20],3,37130],[[2, 9, 20],3,40160],[[2, 10, 20],3,42769],[[2, 11, 20],3,44811],[[2, 12, 20],3,45229],[[2, 13, 20],3,60382],[[2, 14, 20],3,66909],[[2, 15, 20],3,69051],[[2, 16, 20],3,71235],[[2, 17, 20],3,73270],[[2, 18, 20],3,75152],[[2, 19, 20],3,75652],[[2, 20, 20],3,76212],[[2, 21, 20],3,76841],[[2, 22, 20],3,78602],[[2, 23, 20],3,78982],[[2, 24, 20],3,79546],[[2, 25, 20],3,80399],[[2, 26, 20],3,81376],[[2, 27, 20],3,82736],[[2, 28, 20],3,84121],[[2, 29, 20],3,86014],[[3, 1, 20],3,88397],[[3, 2, 20],5,90375],[[3, 3, 20],5,92959],[[3, 4, 20],28,95276],[[3, 5, 20],30,98040],[[3, 6, 20],31,102040],[[3, 7, 20],34,106102],[[3, 8, 20],39,110062],[[3, 9, 20],43,114025],[[3, 10, 20],56,119036],[[3, 11, 20],62,126717],[[3, 12, 20],73,132506],[[3, 13, 20],82,146887],[[3, 14, 20],102,157965],[[3, 15, 20],113,169258],[[3, 16, 20],119,184002],[[3, 17, 20],142,199932],[[3, 18, 20],156,219462],[[3, 19, 20],194,246618],[[3, 20, 20],244,277253],[[3, 21, 20],330,309223],[[3, 22, 20],396,343456],[[3, 23, 20],499,386823],[[3, 24, 20],536,428295],[[3, 25, 20],657,479279],[[3, 26, 20],727,542006],[[3, 27, 20],887,606988],[[3, 28, 20],987,674380],[[3, 29, 20],1024,733777],[[3, 30, 20],1251,799018],[[3, 31, 20],1397,875842],[[4, 1, 20],1998,952368],[[4, 2, 20],2543,1033702],[[4, 3, 20],2567,1116958],[[4, 4, 20],3082,1197315],[[4, 5, 20],3588,1269291],[[4, 6, 20],4778,1342524],[[4, 7, 20],5311,1420265],[[4, 8, 20],5916,1504296],[[4, 9, 20],6725,1590776],[[4, 10, 20],7598,1678316],[[4, 11, 20],8446,1754531],[[4, 12, 20],9205,1849884],[[4, 13, 20],10453,1920029],[[4, 14, 20],11487,1991375],[[4, 15, 20],12322,2073248],[[4, 16, 20],13430,2170168],[[4, 17, 20],14352,2257981],[[4, 18, 20],15722,2331375],[[4, 19, 20],17615,2411347],[[4, 20, 20],18539,2485850],[[4, 21, 20],20080,2561729],[[4, 22, 20],21370,2639748],[[4, 23, 20],23077,2727991],[[4, 24, 20],24530,2812178],[[4, 25, 20],26283,2895859],[[4, 26, 20],27890,2968049],[[4, 27, 20],29451,3037754],[[4, 28, 20],31324,3113246],[[4, 29, 20],33062,3190735],[[4, 30, 20],34863,3274139],[[5, 1, 20],37257,3361356],[[5, 2, 20],39699,3441576],[[5, 3, 20],42505,3518135],[[5, 4, 20],46437,3595235],[[5, 5, 20],49400,3675767],[[5, 6, 20],52987,3765725],[[5, 7, 20],56351,3854800],[[5, 8, 20],59695,3946080],[[5, 9, 20],62808,4031014],[[5, 10, 20],67161,4106229],[[5, 11, 20],70768,4183146],[[5, 12, 20],74292,4267441],[[5, 13, 20],78055,4352288],[[5, 14, 20],81997,4449054],[[5, 15, 20],85784,4545482],[[5, 16, 20],90648,4639704],[[5, 17, 20],95698,4717128],[[5, 18, 20],100328,4805859],[[5, 19, 20],106475,4903092],[[5, 20, 20],112028,5005903],[[5, 21, 20],118226,5112508],[[5, 22, 20],124794,5218600],[[5, 23, 20],131423,5323287],[[5, 24, 20],138536,5417853],[[5, 25, 20],144950,5504248],[[5, 26, 20],150793,5597560],[[5, 27, 20],158086,5700620],[[5, 28, 20],165386,5820202],[[5, 29, 20],173491,5941244],[[5, 30, 20],181827,6078261],[[5, 31, 20],190609,6184917],[[6, 1, 20],198370,6280511],[[6, 2, 20],207191,6401952],[[6, 3, 20],216824,6520126],[[6, 4, 20],226713,6647409],[[6, 5, 20],236184,6778310],[[6, 6, 20],246622,6913202],[[6, 7, 20],257486,7025172],[[6, 8, 20],265928,7127703],[[6, 9, 20],276146,7252461],[[6, 10, 20],286605,7387034],[[6, 11, 20],297535,7525216],[[6, 12, 20],308993,7653814],[[6, 13, 20],320922,7789270],[[6, 14, 20],332424,7922027],[[6, 15, 20],343091,8041844],[[6, 16, 20],354065,8183744],[[6, 17, 20],366946,8326301],[[6, 18, 20],380532,8466697],[[6, 19, 20],395048,8646596],[[6, 20, 20],410451,8803922],[[6, 21, 20],425282,8932267],[[6, 22, 20],440215,9070200],[[6, 23, 20],456183,9235569],[[6, 24, 20],473105,9406545],[[6, 25, 20],490401,9584905],[[6, 26, 20],508953,9776335],[[6, 27, 20],528859,9954911],[[6, 28, 20],548318,10116803],[[6, 29, 20],566840,10273032],[[6, 30, 20],585481,10447289],[[7, 1, 20],604641,10664533],[[7, 2, 20],625544,10872669],[[7, 3, 20],648315,11075391],[[7, 4, 20],673165,11269302],[[7, 5, 20],697413,11452292],[[7, 6, 20],719664,11617941],[[7, 7, 20],742417,11828915],[[7, 8, 20],767296,12041312],[[7, 9, 20],793802,12269423],[[7, 10, 20],820916,12501740],[[7, 11, 20],849522,12718142],[[7, 12, 20],878254,12910765],[[7, 13, 20],906752,13103070],[[7, 14, 20],936181,13324389],[[7, 15, 20],968857,13555611],[[7, 16, 20],1003832,13808279],[[7, 17, 20],1039084,14050533],[[7, 18, 20],1077781,14287418],[[7, 19, 20],1118206,14501583],[[7, 20, 20],1155338,14708250],[[7, 21, 20],1193078,14941878],[[7, 22, 20],1238798,15222711],[[7, 23, 20],1288108,15505806],[[7, 24, 20],1337024,15786391],[[7, 25, 20],1385635,16042089],[[7, 26, 20],1435616,16255260],[[7, 27, 20],1480073,16481553],[[7, 28, 20],1531669,16733998],[[7, 29, 20],1581963,17023686],[[7, 30, 20],1634746,17304066],[[7, 31, 20],1695988,17594163],[[8, 1, 20],1750723,17844596],[[8, 2, 20],1803695,18073489],[[8, 3, 20],1855745,18275011],[[8, 4, 20],1908254,18533677],[[8, 5, 20],1964536,18805749],[[8, 6, 20],2027074,19090844],[[8, 7, 20],2088611,19371914],[[8, 8, 20],2153010,19631160],[[8, 9, 20],2215074,19854598],[[8, 10, 20],2268675,20082310],[[8, 11, 20],2329638,20337232],[[8, 12, 20],2396637,20615100],[[8, 13, 20],2461190,20901479],[[8, 14, 20],2525922,21206137],[[8, 15, 20],2589952,21454001],[[8, 16, 20],2647663,21665916],[[8, 17, 20],2702681,21875838],[[8, 18, 20],2767253,22132337],[[8, 19, 20],2836925,22406764],[[8, 20, 20],2905825,22673939],[[8, 21, 20],2975701,22944256],[[8, 22, 20],3044940,23209579],[[8, 23, 20],3106348,23415376],[[8, 24, 20],3167323,23641687],[[8, 25, 20],3224547,23883773],[[8, 26, 20],3310234,24172616],[[8, 27, 20],3387500,24451719],[[8, 28, 20],3463972,24733263],[[8, 29, 20],3542733,24994138],[[8, 30, 20],3621245,25220408],[[8, 31, 20],3691166,25482822],[[9, 1, 20],3769523,25746973],[[9, 2, 20],3853406,26029674],[[9, 3, 20],3936747,26310532],[[9, 4, 20],4023179,26623252],[[9, 5, 20],4113811,26886427],[[9, 6, 20],4204613,27108461],[[9, 7, 20],4280422,27342175],[[9, 8, 20],4370128,27575506],[[9, 9, 20],4465863,27867793],[[9, 10, 20],4562414,28167019],[[9, 11, 20],4659984,28486877],[[9, 12, 20],4754356,28764152],[[9, 13, 20],4846427,29000205],[[9, 14, 20],4930236,29279898],[[9, 15, 20],5020359,29563691],[[9, 16, 20],5118253,29868540],[[9, 17, 20],5214677,30182274],[[9, 18, 20],5308014,30505689],[[9, 19, 20],5400619,30786774],[[9, 20, 20],5487580,31027510],[[9, 21, 20],5562663,31326812],[[9, 22, 20],5646010,31605997],[[9, 23, 20],5732518,31873009],[[9, 24, 20],5818570,32233965],[[9, 25, 20],5903932,32564294],[[9, 26, 20],5992532,32841726],[[9, 27, 20],6074702,33081936],[[9, 28, 20],6145291,33358976],[[9, 29, 20],6225763,33642960],[[9, 30, 20],6312584,33969937],[[10, 1, 20],6394068,34287271],[[10, 2, 20],6473544,34582698],[[10, 3, 20],6549373,34902647],[[10, 4, 20],6623815,35150468],[[10, 5, 20],6685082,35475879],[[10, 6, 20],6685082,35733340]
	]
	console.log(dailyCumulative.length,dailyCumulative[0])
	dailyCumulative = dailyCumulative.slice(70)
    console.log(dailyCumulative.length,dailyCumulative[0])
    const widthStep = canWidAvailable/dailyCumulative.length;
    function makeGraph(counter){
        if(counter<dailyCumulative.length){
            $('.legendContainer').addClass('active')
            
            const thisDateElement = dailyCumulative[counter];
            
            const dateString = thisDateElement[0]
            $('.month').text(monthNames[dateString[0]-1])
            $('.date').text(dateString[1])
            
            const activeNum = thisDateElement[2]/worldPop;
            const recvNum = thisDateElement[1]/indiaPop;
			
			// const activeNumDiv = thisDateElement[2]/worldPop;
            // const recvNumDiv = thisDateElement[1]/indiaPop;

            
            
            activeNum>=1000?$('.confirmedData').text((activeNum/1000).toFixed(1)+'K'):$('.confirmedData').text(activeNum.toFixed(1))
            recvNum>=1000?$('.recoveredData').text((recvNum/1000).toFixed(1)+'K'):$('.recoveredData').text(recvNum.toFixed(1))
            
            if(counter>0){
                const prevDateElement = dailyCumulative[counter-1];
                const activePrevNum = prevDateElement[2]/worldPop;
                const recvPrevNum = prevDateElement[1]/indiaPop;
                ctx.lineCap = 'round';
                ctx.beginPath();
                ctx.strokeStyle = confirmedColorSwitch;
                ctx.moveTo((widthStep/2)+(widthStep*(counter-1)),(canHgt*(1-((activePrevNum)/heightFactor))));
                ctx.lineTo((widthStep/2)+(widthStep*counter),(canHgt*(1-((activeNum)/heightFactor))))
                ctx.stroke();
                ctx.closePath();

                ctx.beginPath();
                ctx.strokeStyle = recoveredColor;
                ctx.moveTo((widthStep/2)+(widthStep*(counter-1)),(canHgt*(1-(recvPrevNum)/heightFactor)));
                ctx.lineTo((widthStep/2)+(widthStep*counter),(canHgt*(1-(recvNum)/heightFactor)))
                ctx.stroke();
                ctx.closePath();
                
            }
            
            setTimeout(()=>{
                makeGraph(counter+1)
            },secs)
            
        }
    }
    setTimeout(function () {
        // var arr = [0, 1000, 2000, 3000, 4000, 5000,6000,7000,8000,9000,10000,11000]
        // const arr = [0, 25, 50, 75, 100, 125, 150, 175, 200]
        ctx.beginPath();
        ctx.setLineDash([])
        ctx.lineWidth =1;
        ctx.strokeStyle = '#707070';
        ctx.fillStyle = '#707070';
        ctx.rect(canWidAvailable,0,1,canHgt);
        ctx.rect(0,canHgt-1,canWidAvailable,1);
        ctx.fill();
        ctx.closePath();
        for (let counter = 0; counter < 2700; counter+=1) {
            ctx.lineWidth =1;
            ctx.beginPath();
            ctx.font = '500 18px Montserrat'
            ctx.textAlign = 'left';
            if(counter%1 === 0 && counter!==0){
                ctx.fillText(counter+'K', canWidAvailable + 30, 6+(canHgt*(1-(counter*1000/heightFactor))));
                // ctx.fill();
            }else if(counter===0){
                ctx.fillText(counter+'K', canWidAvailable + 30, canHgt);
            }
            ctx.closePath();
            

            ctx.beginPath();
            counter%1 === 0?
                ctx.rect(canWidAvailable,(canHgt*(1-(counter*1000/heightFactor))),20,1)
                :ctx.rect(canWidAvailable,(canHgt*(1-(counter*1000/heightFactor))),10,1);
            ctx.fill();
            ctx.closePath()

            ctx.setLineDash([])
            ctx.lineWidth =5;
        }
        makeGraph(0);
    }, 2000)
    
})